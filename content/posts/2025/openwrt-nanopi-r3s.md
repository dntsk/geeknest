---
title: "Установка OpenWRT на NanoPi R3S"
date: 2025-11-28
author: "Silver Ghost"
tags: ["OpenWRT"]
image: "/images/2025/nanopir3s.jpeg"
description: "Компактный роутер NanoPi R3S за 35 CHF с двумя гигабитными портами. Полная инструкция по установке официального OpenWRT с переносом на eMMC и расширением разделов."
---

Если нужно компактное и мощное решение для домашнего роутера, обратите внимание на NanoPi R3S от FriendlyElec. Стоит он немного — около 35 франков — но при этом обладает двумя гигабитными портами, до 2 ГБ оперативки и 32 ГБ встроенной памяти eMMC. По умолчанию там FriendlyWRT, но я решил поставить официальный OpenWRT — чтобы получить все свежие фишки и обновления безопасности.

## Что нужно для старта

Сначала скачал свежий ext4-образ OpenWRT через удобный Firmware Selector, выбрав NanoPi R3S. Обычно советуют SquashFS — она более стабильна и удобна для роутера, но мне проще править напрямую систему, поэтому выбрал ext4. 

Записал образ на SD-карту (на Linux отлично помогает Gnome Disks, на Windows можно Rufus, на MacOS - Balena Etcher). Засунул карту в NanoPi, подключил кабель к LAN, запустил питанием по USB-C. Если сеть настраивалась как обычно, роутер в локалке будет доступен по адресу 192.168.1.1.

## Перенос на eMMC — обязательно

Хотя можно работать прямо с SD-карты, у eMMC важные преимущества: скорость, износостойкость и надёжность. Чтобы прошить внутреннюю память, скопировал образ в рутовый временный каталог роутера через scp -O (dropbear не умеет в sftp). 

```bash
scp -O /path/to/openwrt...img root@192.168.1.1:/tmp/
```

По SSH выполнил команду:

```bash
dd if=/tmp/openwrt-*.img of=/dev/mmcblk0 bs=4M conv=fsync
sync
```

Теперь нужно убрать карту. Она больше не нужна. 
После перезагрузки роутер запускается с eMMC — никаких тормозов и подвисаний.

## Места и расширение — главное!

Стандартно корневой раздел OpenWRT маленький — всего около 100 мегабайт, что неудобно для установки пакетов и конфигов. Установил нужные пакеты:

```bash
opkg update
opkg install parted losetup resize2fs blkid
```

Скачиваем скрипт для расширения раздела:

```bash
wget -U "" -O expand-root.sh "https://openwrt.org/_export/code/docs/guide-user/advanced/expand_root?codeblock=0"
```

```bash
. ./expand-root.sh
sh /etc/uci-defaults/70-rootpt-resize
```

Роутер сам перезагрузится и разделы вырастут на всё доступное пространство eMMC.

Этот путь избавит от головной боли с файловыми ограничениями и сделает NanoPi настоящим компактным роутером. Доволен результатом, рекомендую!
